<!doctype html><html lang=en data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://ahoi-attacks.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://ahoi-attacks.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://ahoi-attacks.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href=/main.fb4a9200e775a698fccfff90d148386c5368b8917c9e8d6543d02306db453fac3887029ff097bd30009649093e4d60e7399b4cae87928b1d2f9a11f9877107c3.css integrity="sha512-+0qSAOd1ppj8z/+Q0Ug4bFNouJF8no1lQ9AjBttFP6w4hwKf8Je9MACWSQk+TWDnOZtMroeSix0vmhH5h3EHww==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://ahoi-attacks.github.io/heckler/><link rel=canonical href=https://ahoi-attacks.github.io/heckler/><title>Heckler</title>
<meta name=description content="Breaking Confidential VMs with Malicious Interrupts"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:title" content="Heckler"><meta property="og:description" content="Breaking Confidential VMs with Malicious Interrupts"><meta property="og:type" content="article"><meta property="og:url" content="https://ahoi-attacks.github.io/heckler/"><meta property="og:image" content="https://ahoi-attacks.github.io/preview.png?123456"><meta property="article:section" content><meta property="article:published_time" content="2024-04-04T00:04:48+02:00"><meta property="article:modified_time" content="2024-04-04T00:04:48+02:00"><meta property="og:site_name" content="Ahoi Attacks"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ahoi-attacks.github.io/preview.png?123456"><meta name=twitter:title content="Heckler"><meta name=twitter:description content="Breaking Confidential VMs with Malicious Interrupts"><meta name=twitter:site content="@sectrs_ethz"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://ahoi-attacks.github.io/","name":"Ahoi Attacks","position":1},{"@type":"ListItem","name":"Heckler","position":2}]}</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-N42SFQ45B4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-N42SFQ45B4")</script><script>console.log("<!-- Hacked together with <3 in emacs --->")</script></head><body class="single heckler" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-lg><a class="navbar-brand me-auto me-lg-3" href=/>Ahoi Attacks</a>
<button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>Ahoi Attacks</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class="nav-link active" href=https://ahoi-attacks.github.io/heckler/ aria-current=true>Heckler</a></li><li class=nav-item><a class=nav-link href=https://ahoi-attacks.github.io/wesee>WeSee</a></li><li class=nav-item><a class=nav-link href=https://ahoi-attacks.github.io/sigy>Sigy</a></li><li class=nav-item><a class=nav-link href=https://ahoi-attacks.github.io/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=https://ahoi-attacks.github.io/media/>Media</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website">
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme"><svg data-bs-theme-value="dark" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg><svg data-bs-theme-value="light" xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://twitter.com/sectrs_ethz><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg><small class="ms-2 visually-hidden">Twitter</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://github.com/ahoi-attacks><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul></div></div></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=UTF-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class="submitted d-none"><time class=created-date>Date here</time></div></header><div class=content>Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-lg" role=document><div class=content><div class="row flex-xl-nowrap"><nav class="docs-toc docs-toc-offset d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#how-does-it-work>How Does It Work?</a><ul><li><a href=#int-0x80>Int 0x80</a></li><li><a href=#signals>Signals</a></li></ul></li><li><a href=#breaking-into-cvms-with-heckler>Breaking into CVMs with Heckler</a><ul><li><a href=#openssh>OpenSSH</a></li><li><a href=#sudo>Sudo</a></li></ul></li><li><a href=#affected-hardware-and-software>Affected Hardware and Software</a></li><li><a href=#faq>FAQ</a></li><li><a href=#authors>Authors</a></li><li><a href=#responsible-disclosure>Responsible Disclosure</a></li><li><a href=#cve>CVE</a></li><li><a href=#acknowledgments>Acknowledgments</a></li></ul></nav></div></nav><div class='docs-content col-lg-0 col-xl-2'></div><main class="docs-content col-lg-16 col-xl-9"><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#how-does-it-work>How Does It Work?</a><ul><li><a href=#int-0x80>Int 0x80</a></li><li><a href=#signals>Signals</a></li></ul></li><li><a href=#breaking-into-cvms-with-heckler>Breaking into CVMs with Heckler</a><ul><li><a href=#openssh>OpenSSH</a></li><li><a href=#sudo>Sudo</a></li></ul></li><li><a href=#affected-hardware-and-software>Affected Hardware and Software</a></li><li><a href=#faq>FAQ</a></li><li><a href=#authors>Authors</a></li><li><a href=#responsible-disclosure>Responsible Disclosure</a></li><li><a href=#cve>CVE</a></li><li><a href=#acknowledgments>Acknowledgments</a></li></ul></nav></div></details></nav><div class=text-center style=padding-bottom:3rem><div><img src=/Heckler-symbol.svg style=margin-top:2rem;margin-bottom:-1rem;width:300px></div><h1 class=h1>Heckler</h1><p class=lead>Breaking Confidential VMs with Malicious Interrupts</br>(<a href=https://www.usenix.org/conference/usenixsecurity24>USENIX Security 2024</a>)</p><div class="row justify-content-center"><div class="col-lg-5 col-sm-6 text-center" style=margin-top:1.2rem><div class="d-flex flex-column flex-sm-row w-100 text-center"><a class="btn btn-primary btn-cta rounded-pill btn-lg head-button" href=/heckler/heckler_usenix24.pdf role=button>Paper</a></div></div><div class="col-lg-5 col-sm-6" style=margin-top:1.2rem><div class="d-flex flex-column flex-sm-row"><a class="btn btn-primary btn-cta rounded-pill btn-lg head-button" href=https://github.com/ahoi-attacks/heckler role=button>Source</a></div></div><div class="col-lg-5 col-sm-6" style=margin-top:1.2rem><div class="d-flex flex-column flex-sm-row"><a class="btn btn-primary btn-cta rounded-pill btn-lg head-button" href=#cve role=button>CVE</a></div></div></div></div><h2 id=how-does-it-work>How Does It Work?<a href=#how-does-it-work class=anchor aria-hidden=true>#</a></h2><p>AMD SEV-SNP and Intel TDX enable Confidential VMs (CVMs). With these CVMs, the
untrusted hypervisor is still responsible for resource and configuration
management. Consequently, the hypervisor also manages interrupts for CVMs. In
Heckler, the hypervisor uses malicious interrupts to compromise the security of
the CVMs. Our insight is to use the <a href=/blog/ahoi-overview/#interrupt-delivery-to-confidential-vms>interrupt handlers</a>
that have <a href=/blog/ahoi-overview/#exploiting-global-effects-of-handlers>global effects</a>, such that we can manipulate a
CVM’s register states to change the data and control flow. Let’s first look at
how interrupts are handled during a benign execution. The hypervisor hooks on
physical interrupts from the interrupt controller and sends them to the CVMs.
The CVMs service these interrupts by executing handlers. In the x86
architecture, hardware exceptions (e.g., divide-by-zero, undefined instruction)
are also mapped to interrupt numbers. For a detailed explanation check out our
<a href=/blog/ahoi-overview/>blog post</a>.</p><h3 id=int-0x80>Int 0x80<a href=#int-0x80 class=anchor aria-hidden=true>#</a></h3><p>In the x86 architecture, user-space applications execute legacy 32-bit system
calls using the <code>int 0x80</code> instruction. When the hardware executes this
instruction, it raises interrupt number 128 (0x80) which invokes the 32-bit
system call handler in the Linux kernel. This system call handler has a global
effect—it returns the result of the system call in <code>rax</code>. We use this global
effect in the handler to compromise the CVMs execution. Specifically, a
malicious hypervisor injects <code>int 0x80</code> to induce a change in the value of <code>rax</code>
that a victim application uses. For example, change <code>rax</code> right before an
application checks it to successfully authenticate a user. This allows the
malicious hypervisor to bypass authentication checks (e.g., OpenSSH, sudo).</p><p><img src=/heckler/heckler-int80.webp width=960 height=288 decoding=async fetchpriority=auto loading=lazy alt="Heckler Int80" id=h-rh-i-0></p><h3 id=signals>Signals<a href=#signals class=anchor aria-hidden=true>#</a></h3><p>The OS converts different hardware exceptions to signals that are delivered to
user-space applications. The applications register signal handlers which can
have <a href=/blog/ahoi-overview/#exploiting-global-effects-of-handlers>global effects</a>. In AMD SEV-SNP, the hardware
exceptions are mapped to interrupt numbers that a malicious hypervisor can
inject. These malicious interrupts trick the OS into sending a signal to the
user-space application. Depending on the effects application’s signal handler,
this malicious interrupt injection can be used to compromise the security of the
CVM.</p><p>In the Animation below, the function updates the mean of a data set when new data is added to it. Crucially, in a signal handler, the application discards any faulty data (e.g., data that overflows the mean) and reverts the mean. An attacker can bias this data set by using Heckler.</p><p><img src=/heckler/heckler-signals.webp width=960 height=540 decoding=async fetchpriority=auto loading=lazy alt="Heckler Signals" id=h-rh-i-1></p><h2 id=breaking-into-cvms-with-heckler>Breaking into CVMs with Heckler<a href=#breaking-into-cvms-with-heckler class=anchor aria-hidden=true>#</a></h2><h3 id=openssh>OpenSSH<a href=#openssh class=anchor aria-hidden=true>#</a></h3><p>Using Heckler, we attack OpenSSH <code>v9.4.P1+</code> to compromise its authentication and
get a shell on the CVM. Without Heckler, the attacker is not authorized to get a
shell.</p><p><img src=/heckler/heckler-pages.webp width=960 height=327 decoding=async fetchpriority=auto loading=lazy alt="Heckler Gadgets" id=h-rh-i-2></p><p>Specifically, OpenSSH calls <code>mm_answer_authpassword</code> to decide if authentication
is successful. We use Heckler’s <code>int 0x80</code> attack and inject an interrupt when
this function executes to change its return value. To determine when to inject
the interrupt, we use the hypervisor’s ability to observe page faults.
<code>mm_answer_authpassword</code> invokes <code>auth_password</code> on a different page. We inject
<code>int 0x80</code> when we observe that execution returns back to the
<code>mm_answer_authpassword</code> to compromise its return value.</p><iframe width=100% height=515 style=margin-top:2rem;margin-bottom:2rem src="https://www.youtube.com/embed/pQCvn9S1Jbc?si=oCL6dyuV6KqqCan9&rel=0" title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy=strict-origin-when-cross-origin allowfullscreen></iframe><h3 id=sudo>Sudo<a href=#sudo class=anchor aria-hidden=true>#</a></h3><p>We demonstrate an attack on the sudo binary in the Ubuntu 23.10 distribution to get a root shell on the CVM. Specifically, an attacker with a non-root shell on the CVM can escalate privilege to a root shell using Heckler.</p><p>Like the OpenSSH attack, we identify functions that lie on different pages. We observe the page trace in the hypervisor and use int 0x80 to compromise the return values leading to successful authentication.</p><iframe width=100% height=515 style=margin-top:2rem;margin-bottom:2rem src="https://www.youtube.com/embed/Q9TEmhh6ufE?si=HSzBchc2gs8nv96B&rel=0" title="YouTube video player" frameborder=0 allow="accelerometer; autoplay;
clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy=strict-origin-when-cross-origin allowfullscreen></iframe><p>In summary, a malicious hypervisor can use Heckler to gain access to a shell (using the OpenSSH attack) on the CVM and escalate privilege to a root shell (using the sudo attack). Further, Heckler can be used to compromise victim applications by sending arbitrary signals. For more details, please see our <a href=/heckler/heckler_usenix24.pdf>paper</a> and our <a href=https://github.com/ahoi-attacks>code</a>.</p><h2 id=affected-hardware-and-software>Affected Hardware and Software<a href=#affected-hardware-and-software class=anchor aria-hidden=true>#</a></h2><p>All Intel TDX and AMD SEV-SNP processors are vulnerable to Heckler. See our FAQs for more information.</p><h2 id=faq>FAQ<a href=#faq class=anchor aria-hidden=true>#</a></h2><details><summary>Q: Does this attack apply to other versions of SEV (e.g., SEV-ES)?</summary><ul><li>While we haven’t tested this, in theory, yes all older versions of SEV are
vulnerable to Heckler.</li></ul></details><details><summary>Q: Does the <code>int 0x80</code> attack only work on 32-bit binaries?</summary><ul><li>No. <code>int 0x80</code> is used to invoke legacy 32-bit system calls. This instruction
is also valid in 64-bit binaries. Furthermore, Heckler does not require the
application to explicitly execute the <code>int 0x80</code> instruction. Therefore, all
application binaries are vulnerable to Heckler if they execute with a Linux
kernel that registers a vulnerable <code>int 0x80</code> handler.</li></ul></details><details><summary>Q: Does Heckler affect non-confidential VMs that I have in the cloud?</summary><ul><li>No. Heckler assumes a malicious hypervisor to inject interrupts. For normal
cloud VMs, the hypervisor is implicitly trusted and will not attack the VMs.
Also, co-tenant VMs cannot use Heckler because the hypervisor detects and
filters any malicious interrupt injections from other VMs.</li></ul></details><details><summary>Q: How do I protect myself from Heckler?</summary><ul><li><p>Heckler is tracked under 2 <a href=#cve>CVEs</a>: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-25744">CVE-2024-25744</a> and <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-25743">CVE-2024-25743</a></p></li><li><p>For Intel TDX, there are <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f4116bfc44621882556bbf70f5284fbf429a5cf6">patches</a> to the Linux kernel that check if <code>int 0x80</code> is externally injected. TDX is not vulnerable to the attack from signals as the hardware blocks external injection of interrupts between 0-30.</p></li><li><p>For AMD SEV-SNP, <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b82a8dbd3d2f4563156f7150c6f2ecab6e960b30">turn off x86 emulation in the Linux
kernel</a>
which will prevent Heckler from using the effects of the <code>int 0x80</code> handler.
Currently, there is no fix to protect against Heckler’s signal attacks.</p></li><li><p>For robust defense, we recommend that cloud users switch to protected interrupt
delivery available on AMD SEV-SNP. Unfortunately, as of 4th April 2024, there
is no software support to use this hardware feature in neither mainline Linux
nor AMD prototype.</p></li></ul></details><details><summary>Q: Is this a side-channel attack?</summary><ul><li>No. Heckler is not a side-channel attack.</li></ul></details><details><summary>Q: What about other interrupt vectors?</summary><ul><li>In Heckler, we focused on using interrupt vectors with handlers that had
global effects. Please see our <a href=/heckler/heckler_usenix24.pdf>paper</a> for a
detailed analysis of the other interrupt vectors.</li></ul></details><details><summary>Q: How is this an Ahoi attack?</summary><ul><li>Heckler abuses interrupts, a notification mechanism, to compromise CVMs making it an Ahoi attack.</li></ul></details><details><summary>Q: Why the name Heckler?</summary><ul><li>To heckle is to interrupt a speaker with a derisive comment. Our attack
interrupts the VM execution, acting like a “heckler” during a CVM execution.</li></ul></details><details><summary>Q: What was the response from hardware manufacturers?</summary><ul><li>Intel and AMD acknowledged the attacks but concluded that this is a
vulnerability in the third-party software implementations of SEV-SNP and TDX.
You find more information in their respective security advisories (<a href=https://www.intel.com/content/www/us/en/security-center/announcement/intel-security-announcement-2024-04-08-001.html>Intel</a>, <a href=https://www.amd.com/en/resources/product-security/bulletin/amd-sb-3008.html>AMD</a>).</li></ul></details><details><summary>Q: What was the response from cloud vendors?</summary><ul><li><p>Azure thanked us for the disclosure and communicated that both Azure
Confidential Computing and Azure confidential VMs are not vulnerable because
they use restricted and alternate injection modes supported by AMD SEV-SNP.</p></li><li><p>AWS thanked us for the disclosure and communicated the following:</p><ul><li>AWS is aware of <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-25742">CVE-2024-25742</a>, <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-25743">CVE-2024-25743</a>, and <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-25744">CVE-2024-25744</a>, which
describes issues related to AMD Secure Encrypted Virtualization-Secure Nested
Paging (SEV-SNP). These CVEs describe paths through which an untrusted
hypervisor can inject interrupts into a virtualized guest running in an
SEV-SNP environment to obtain data from the guest that it should not be able
to read. Amazon EC2 does not rely on AMD SEV-SNP, Intel TDX, or similar
affected technologies, to provide confidentiality and integrity protections to
customers. The built-in hardware and associated firmware for confidentiality
protections of the EC2 Nitro Systems are offered to all customers by default;
these components are not affected by these issues. To support customers
running Amazon Linux as virtualized guests using AMD SEV-SNP, we are working
to release a kernel addressing the CVEs in the next release cycle.</li></ul></li><li><p>Google thanked us for the disclosure and is investigating it. At the
moment, they have neither confirmed nor denied the issue.</p></li></ul></details><h2 id=authors>Authors<a href=#authors class=anchor aria-hidden=true>#</a></h2><ul><li><a href=https://benschlueter.com/>Benedict Schlüter</a></li><li><a href=https://suprajas.com/>Supraja Sridhara</a></li><li><a href=https://mark-kuhne.com/>Mark Kuhne</a></li><li><a href=https://abertschi.ch/>Andrin Bertschi</a></li><li><a href=https://shwetashinde.com>Shweta Shinde</a></li></ul><h2 id=responsible-disclosure>Responsible Disclosure<a href=#responsible-disclosure class=anchor aria-hidden=true>#</a></h2><p>We informed Intel and AMD about int 0x80 on the 27th and 28th September 2023
respectively. We updated AMD on 14th October 2023 about our findings for other
interrupts and our analysis of their defenses. At the request of AMD, we
extended the embargo till 4 April 2024.</p><h2 id=cve>CVE<a href=#cve class=anchor aria-hidden=true>#</a></h2><p>Heckler is tracked under the following CVEs:</p><ul><li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-25744">CVE-2024-25744</a></li><li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-25743">CVE-2024-25743</a></li></ul><h2 id=acknowledgments>Acknowledgments<a href=#acknowledgments class=anchor aria-hidden=true>#</a></h2><p>Thanks to Intel, AMD, and Linux for the mitigation discussions and for
developing the patches. We thank Benny Fuhry and Mona Vij from Intel for
granting us early-access to TDX pre-production machines.</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/sigy/ class="stretched-link text-reset text-decoration-none">Sigy</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/wesee/ class="stretched-link text-reset text-decoration-none">WeSee</a></div><div class="d-flex flex-column justify-content-center"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main><div class='docs-content col-lg-0 col-xl-2'></div></div></div></div><footer class="footer text-muted"><div class=container-lg><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/imprint>Imprint</a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=https://sectrs.ethz.ch/>Secure and Trustworthy Systems Group, ETH Zurich</a></li></ul></div></div></div></footer><script async src=/js/app.47b84f3b640408af6efe7bf4add1a36f5b9c6227fbae7b8bcdf0c9ce42fefc54.js integrity="sha256-R7hPO2QECK9u/nv0rdGjb1ucYif7rnuLzfDJzkL+/FQ="></script><script async src=/js/flexsearch.b6f80717bc68cd38b6ded7a061f96a73896db6be17a6582f09a63a6040040919.js integrity="sha256-tvgHF7xozTi23tegYflqc4lttr4XplgvCaY6YEAECRk="></script><script async src=/js/search-modal.4e30271fef6fac86c3b4143167e9784bd3f7037ce1045d03a321e7e799e91476.js integrity="sha256-TjAnH+9vrIbDtBQxZ+l4S9P3A3zhBF0DoyHn55npFHY="></script></body></html>